# 2699 旅行

## 题目描述

EZ 同学家里非常富有，但又极其的谦虚，说话又好听，是个不可多得的人才。

EZ 常常在假期环游世界，他准备去 $$n$$ 个国家之多，一些国家有航线连接，由于 EZ 同学有一定的强迫症，任意两个国家之间都能通过航路直接或间接到达，并且这样的路径仅有一种。（简单来说，这些国家构成了一棵树）

由于 EZ 是 C 国人，因此将 C 国（1 号国家）作为整棵树的根。

每个国家有一个旅游热度 $$a_i$$ 和影响力 $$d_i$$。由于目的地有点多，为了避免选择困难症，他给每个国家设置了一个向往值 $$f_i$$，它等于所有的 $$a_j $$ 之和，满足 $$i$$ 国在 $$j$$ 国向 C 国走 $$d_j$$ 步的路径上（经过一条航路算一步，$$i = j$$ 也会被统计，如果 $$d_j$$ 步超过了 C 国，则超过部分不用管）。

LYD 同学家里有矿，富有程度与 EZ 不相上下，但他却在宅与现中间摇摆不定。某次机缘巧合，EZ 外出旅游刺激了 LYD，他决定也要开始旅游。为了避免又被判高重复率导致被取消资格，他将 EZ 的旅游地图略微做了一点调整，每条航路将有一定的概率出现。

现在他有 Q 个询问，每次询问某个国家所在的连通块（由于每条边是一定的概率出现，因此它所在的连通块可以是很多种）中所有国家的 $$f_i$$ 值的和的平方的期望（对 `998244353` 取模），以此来决定他旅游的目的地。但他极其厌恶繁琐的计算，于是他找到了能算出圆周率并将它倒背下来的你，答应给你丰厚的报酬。家里没矿，老爸也不是 X 达集团老总的你决定接受他的任务。

## 输入格式

第一行一个正整数 $$n$$，表示国家数。

接下来 $$n$$ 行，第 $$i$$ 行两个非负整数 $$a_i,\,d_i$$，表示国家 $$i$$ 的旅游热度以及影响力。

接下来 $$n-1$$ 行，每行三个非负整数 $$x,\,y,\,v$$，$$x,\,y$$ 为这条航路连接的两个国家，$$v$$ 为这条航路出现的概率。（注意每个在 EZ 的地图中是没有出现概率带说法的，因此每个国家的 $$f$$ 值与边的出现概率无关）

接下来一行一个正整数 $$q$$，表示询问数。

接下来 $$q$$ 行，每行一个正整数 $$x$$，表示询问国家 $$x$$ 所在的连通块中所有国家的 $$f_i$$ 值的和的平方的期望（对 `998244353` 取模）。

## 输出格式

共 $$q$$ 行，每行一个非负整数表示这次询问的答案。

## 输入样例 1

{% code-tabs %}
{% code-tabs-item title="sample1.in" %}
```text
5
2 1
1 0
3 1
3 2
1 4
1 2 1
1 3 1
2 4 1
2 5 0
3
1
3
5
```
{% endcode-tabs-item %}
{% endcode-tabs %}

## 输出样例 1

{% code-tabs %}
{% code-tabs-item title="sample1.out" %}
```text
400
400
1
```
{% endcode-tabs-item %}
{% endcode-tabs %}

## 输入样例 2

{% code-tabs %}
{% code-tabs-item title="sample2.in" %}
```text
4
5 1
3 0
10 2
4 1
1 2 74017368
1 3 59531864
2 4 25036401
3
4
2
3

```
{% endcode-tabs-item %}
{% endcode-tabs %}

## 输出样例 2

{% code-tabs %}
{% code-tabs-item title="sample2.out" %}
```text
988451137
606447316
733454972
```
{% endcode-tabs-item %}
{% endcode-tabs %}

## 样例解释

### 样例 1

对于样例 1，可算出各国的 $$f$$ 值分别为 9, 5, 3, 1, 1；1, 2, 3, 4 必定在同一个连通块中，5 在另一个连通块。

1, 2, 3, 4 所在连通块 $$f$$ 值的和为 20，因此答案是 400；5 所在的连通块 $$f$$ 值的和为 1，因此答案是 1。

### 样例 2

对于样例 2，可算出各国的 $$f$$ 值分别为 15, 7, 10, 4，根据期望的定义，可计算出答案。

## 数据范围

| 测试点 | $$n$$ | $$q$$ | 特殊性质 |
| :---: | :---: | :---: | :---: |
| 1 | $$10$$ | $$10$$ | 无 |
| 2, 3 | $$10^3$$ | $$10^3$$ | 无 |
| 4 | $$2 \times 10^5$$ | $$100$$ | 无 |
| 5 | $$2 \times 10^5$$ | $$2 \times 10^5$$ | 每条边出现的概率为 0 或 1 |
| 6, 7 | $$2 \times 10^5$$ | $$2 \times 10^5$$ | 树退化为一条链，第 $$i$$ 与 $$i + 1$$ 相连 |
| 8, 9, 10 | $$2 \times 10^5$$ | $$2 \times 10^5$$ | 无 |

对于 100% 的数据，$$1 \leq n, q \leq 2 \times 10^5,\ 0 \leq a_i, v < 998244353,\ 0 \leq d_i < n$$。

## 提示

题目中所有概率、期望均由这种形式表示或输出：

假设这个值为 $$\frac{p}{q}$$，那么用来表示的是 $$p \cdot q^{-1} \mod{998244353}$$ ，其中 $$q^{-1}$$ 为 $$q$$ 在模 `998244353` 下的逆元，即 $$q \cdot q^{-1} \equiv 1\ (\operatorname{mod} 998244353)$$，保证这样的逆元一定存在。

期望的定义：期望为每种情况的答案乘上这种情况的概率的总和，你可以理解为各种情况的加权平均数。

这题说不定你会做。

## 来源

[JZOJ 5911](https://jzoj.net/senior/#main/show/5911)

